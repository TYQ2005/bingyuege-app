# 冰阅 · 完整功能与规则指南

**版本**: 2.0  
**更新时间**: 2026年2月14日  
**应用名称**: 冰阅阁 (bingyuege-app)  
**平台**: Android 6.0+ (API 23+)

---

## 📋 目录

1. [应用概述](#应用概述)
2. [功能完整列表](#功能完整列表)
3. [使用规则与逻辑](#使用规则与逻辑)
4. [快捷键与手势](#快捷键与手势)
5. [数据管理规则](#数据管理规则)
6. [交互逻辑与工作流](#交互逻辑与工作流)
7. [动画与视觉反馈](#动画与视觉反馈)
8. [故障排除](#故障排除)
9. [技术架构](#技术架构)

---

## 应用概述

### 🎯 核心价值
冰阅是一款以用户体验为首的多功能阅读应用，通过灵活的书源导入机制，为用户提供：
- **自由的书源管理**: 支持多种数据格式导入
- **沉浸式阅读体验**: 流畅的翻页、主题切换、进度保存
- **个性化设置**: 字体、颜色、阅读模式自定义
- **智能进度跟踪**: 自动保存阅读位置和历史记录

### 👥 目标用户
- 喜爱阅读的爱好者
- 希望自定义книжных источников的用户
- 需要跨设备同步阅读进度的用户

---

## 功能完整列表

### 1️⃣ 书源管理模块

#### 1.1 新增书源
**规则**:
- 每个书源需要唯一的名称和有效的URL
- 支持HTTP/HTTPS协议
- URL必须指向JSON、XML或文本格式的数据源
- 名称长度: 1-50 字符
- URL长度: 10-500 字符

**交互流程**:
```
点击"➕ 新增" → 输入名称和URL → 点击"保存" → 书源列表更新
```

**验证规则**:
- ❌ 空字段: 显示"请填写完整信息"的提示
- ✅ 保存成功: 显示"✓ 保存成功"并返回列表

#### 1.2 导入书源

**支持的导入格式**:

**JSON格式** (数组或对象)
```json
[
  { "name": "笔趣阁", "url": "https://..." },
  { "title": "起点中文", "link": "https://..." }
]
```

**XML格式**
```xml
<sources>
  <source>
    <name>书源名</name>
    <url>https://...</url>
  </source>
</sources>
```

**文本列表格式**
```
书源名称1|https://url1
书源名称2|https://url2
```

**URL导入**
- 输入指向JSON、XML或文本文件的完整URL
- 应用自动检测格式并解析
- 支持跨域资源共享(CORS)

**导入规则**:
- 每次最多导入100个书源
- 自动去重（防止重复导入）
- 失败的书源自动跳过
- 显示成功导入数量

#### 1.3 编辑书源
**规则**:
- 只能编辑名称和URL
- 编辑后自动更新缓存数据
- 正在阅读的书籍关联更新

#### 1.4 删除书源
**规则**:
- 删除前需要二次确认
- 删除书源不影响已加入书架的书籍
- 删除书源不删除阅读进度

---

### 2️⃣ 书籍浏览模块

#### 2.1 书籍列表加载

**规则**:
- 首次加载显示"加载中..."的loading动画
- 从缓存加载时立即显示
- 支持的字段优先级:
  - 标题: `title` > `name`
  - 作者: `author` > `writer`
  - 封面: `cover` > `image` > `img`
  
- 缺少数据时使用默认值:
  - 无标题: "未知书名"
  - 无作者: "未知作者"
  - 无封面: placeholder图片

#### 2.2 书籍显示格式

列表项包含:
```
┌─────────────────────────┐
│ [封面] 书名              │
│         作者            │
│         点击阅读         │
└─────────────────────────┘
```

**交互**:
- 单击打开阅读器
- 长按(>1s)显示快捷提示

#### 2.3 搜索与过滤
- 支持本地搜索（客户端过滤）
- 按标题模糊匹配
- 实时显示搜索结果

---

### 3️⃣ 书架模块

#### 3.1 书架功能

**书架项包含信息**:
```
- 书籍ID和基本信息
- 最后阅读时间
- 最后阅读章节索引
- 阅读进度百分比
```

**显示规则**:
- 按"最后阅读时间"降序排列
- 显示阅读进度条（百分比）
- 显示"第N章·X%"的进度文本

#### 3.2 添加到书架

**规则**:
- 只能在阅读器中添加
- 同一书籍多次添加时自动更新进度
- 添加时记录当前章节、时间戳

**触发方式**:
1. 阅读器工具栏点击"📚 加书架"
2. 键盘快捷键 `B`
3. 自动保存(每次翻页自动记录)

#### 3.3 书架删除

- 在书架列表左滑删除（如果实现）
- 或通过长按菜单删除
- 删除不影响阅读进度记录

---

### 4️⃣ 阅读器模块

#### 4.1 章节显示

**布局结构**:
```
┌─────────────────────────┐
│ 第一章 开始              │
│ 第 1 章 / 共 10 章       │
├─────────────────────────┤
│ 正文内容...              │
│ (首行缩进, 行距2)       │
│                         │
└─────────────────────────┘
```

**文本格式**:
- 首行缩进 (text-indent: 2em)
- 行高: 2
- 段落间距: 自动

#### 4.2 翻页逻辑

**翻页命令来源** (优先级从高到低):
1. 键盘快捷键 (← | A/a | →  | D/d | 空格)
2. 手势滑动 (水平滑动>50px, <500ms)
3. UI按钮 (⬅️ 上一章 | ➡️ 下一章)

**翻页边界处理**:
- 已是第一章: 提示"⬅️ 已是第一章"
- 已是最后一章: 提示"➡️ 已是最后一章"
- 进度显示: "📖 进度: X%"

#### 4.3 章节目录

**功能**:
- 显示该书所有章节列表
- 支持快速跳转到任意章节
- 当前章节高亮显示
- 点击自动滚动到该章节

#### 4.4 工具栏按钮

| 按钮 | 功能 | 快捷键 |
|-----|-----|--------|
| ⬅️ | 上一章 | ← / A / a |
| 📚 | 加书架 | B / b |
| ☰ | 打开目录 | Q / q / Esc |
| ➡️ | 下一章 | → / D / d / Space |

---

### 5️⃣ 主题与设置

#### 5.1 深色/浅色主题

**浅色主题**:
- 背景: #f5f5f5
- 文字: #333333
- 卡片: #ffffff
- 边框: #e0e0e0

**深色主题**:
- 背景: #121212
- 文字: #e0e0e0
- 卡片: #1e1e1e
- 边框: #333333

**切换规则**:
- 实时应用到整个应用
- 状态保存到localStorage
- 启用时显示"🌙 已开启夜间模式"

#### 5.2 清除数据

**数据清除范围**:
- ✓ 所有书源
- ✓ 书架书籍
- ✓ 阅读进度
- ✓ 主题设置
- ✓ 所有localStorage数据

**清除流程**:
```
点击"清除缓存" → 确认对话框 → 清除 → 刷新应用
```

---

## 使用规则与逻辑

### 书源数据格式规范

#### JSON格式规范

**推荐结构**:
```json
{
  "sources": [
    {
      "id": "unique_id",
      "name": "书源名称",
      "url": "https://api.example.com",
      "enabled": true,
      "priority": 1
    }
  ]
}
```

**兼容结构** (自动识别):
```json
[
  { "name": "...", "url": "..." },
  { "title": "...", "link": "..." }
]
```

#### XML格式规范

```xml
<?xml version="1.0" encoding="UTF-8"?>
<sources>
  <source>
    <id>1</id>
    <name>书源名</name>
    <url>https://...</url>
    <enabled>1</enabled>
  </source>
</sources>
```

**字段映射**:
- `<name>` 或 `<title>` → 书源名
- `<url>` 或 `<address>` → 书源地址

#### 文本列表规范

```
格式1 (首选): 名称|URL
格式2: 名称[TAB]URL

示例:
笔趣阁|https://www.biquge.io
起点中文|https://www.qidian.com
```

### 书籍数据格式规范

#### JSON格式

```json
{
  "books": [
    {
      "id": "book_1",
      "title": "书名",
      "author": "作者",
      "cover": "https://...",
      "url": "https://...",
      "chapters": [
        {
          "id": "ch_1",
          "title": "第一章",
          "url": "https://...",
          "content": "章节内容"
        }
      ]
    }
  ]
}
```

#### 字段映射优先级

**标题**: `title` > `name` > `bookName`

**作者**: `author` > `writer` > `authorName`

**封面**: `cover` > `image` > `img` > `picture`

**内容**: `content` > `text` > `html`

---

## 快捷键与手势

### ⌨️ 键盘快捷键

| 快捷键 | 功能 | 环境 |
|--------|-----|------|
| `←` | 上一章 | 阅读器/目录 |
| `A` 或 `a` | 上一章 | 阅读器 |
| `→` | 下一章 | 阅读器/目录 |
| `D` 或 `d` | 下一章 | 阅读器 |
| `Space` | 下一章 | 阅读器 |
| `Q` 或 `q` | 打开/关闭目录 | 阅读器 |
| `B` 或 `b` | 加书架 | 阅读器 |
| `Esc` | 返回阅读器(从目录) | 目录 |

### 👆 手势操作

| 手势 | 动作 | 功能 |
|------|------|------|
| 向左滑动 | 快速水平滑动(>50px, <500ms) | 下一章 |
| 向右滑动 | 快速水平滑动(>50px, <500ms) | 上一章 |
| 长按 | 按住>1秒 | 显示快捷提示 |
| 单击 | 快速轻触 | 打开/进入 |

---

## 数据管理规则

### LocalStorage 数据结构

```javascript
{
  // 书源列表
  "sources": [
    { "id": "...", "name": "...", "url": "..." }
  ],
  
  // 书架书籍
  "shelfBooks": [
    {
      "id": "...",
      "title": "...",
      "author": "...",
      "chapters": [...],
      "lastChapterIndex": 5,
      "lastReadTime": 1707894000000
    }
  ],
  
  // 阅读进度
  "readingProgress": {
    "book_id": {
      "bookTitle": "...",
      "chapterIndex": 5,
      "chapterTitle": "...",
      "timestamp": 1707894000000
    }
  },
  
  // 主题设置
  "darkMode": true
}
```

### 缓存策略

**书籍数据缓存** (`booksCache`)
- 存储位置: 内存 (不持久化)
- 生命周期: 应用会话内有效
- 触发更新: 切换书源
- 缓存键: `source.id`

**书架数据**
- 存储位置: localStorage
- 持久化: 永久保存
- 自动更新: 每次翻页

**阅读进度**
- 存储位置: localStorage  
- 更新频率: 每次翻页
- 恢复机制: 自动恢复上次位置

---

## 交互逻辑与工作流

### 核心工作流

#### 工作流1: 首次使用

```
应用启动
  ↓
加载本地数据 (sources, shelfBooks)
  ↓
渲染书源列表
  ↓
显示"暂无书源"提示
  ↓
用户选择导入或新增
```

#### 工作流2: 导入书源

```
点击"📥 导入"
  ↓
打开导入弹窗
  ↓
选择导入方式 (JSON/XML/文本/URL)
  ↓
输入/粘贴数据
  ↓
点击"导入"
  ↓
后台解析与验证
  ↓
显示状态: "⏳ 处理中..."
  ↓
成功: "✓ 成功导入 X 个书源"
  ↓
刷新书源列表
  ↓
关闭弹窗
```

#### 工作流3: 阅读书籍

```
点击书源
  ↓
加载书籍列表 (displays: loading状态)
  ↓
显示书籍列表
  ↓
点击书籍
  ↓
生成章节列表
  ↓
加载第一章
  ↓
进入阅读器
  ↓
显示"✓ 已添加到书架" (如果是首次)
  ↓
可选: 点击"加书架"保存进度
```

#### 工作流4: 快速导航

```
在阅读器中
  ↓
选择导航方式:
  - 左划 → 上一章
  - 右划 → 下一章
  - 点击"☰ 目录" → 打开目录
  - 键盘快捷键
  ↓
更新章节内容
  ↓
更新进度显示
  ↓
自动保存进度
  ↓
显示"📖 进度: X%"
```

### 错误处理逻辑

```javascript
错误类型 → 用户提示 → 建议操作
--------------------------------------
网络错误 → "❌ 网络连接失败" → 重试导入
JSON解析失败 → "❌ JSON格式错误" → 检查格式
XML解析失败 → "❌ XML格式错误" → 检查格式
空数据 → "❌ 未找到数据" → 检查URL
无章节 → "❌ 章节加载失败" → 返回重选
```

---

## 动画与视觉反馈

### 动画种类

| 动画名 | 持续时间 | 用途 | 应用场景 |
|--------|--------|------|---------|
| slideUp | 0.3-0.5s | 从下向上 | 页面进入、列表项 |
| slideDown | 0.3s | 从上向下 | 页面退出 |
| slideInLeft | 0.4s | 从左向右 | 阅读器内容 |
| slideInRight | 0.4s | 从右向左 | 目录页 |
| fadeIn | 0.3-0.5s | 淡入 | 模态框、loading |
| fadeOut | 0.3s | 淡出 | 页面关闭 |
| pulse | 0.5-1.5s | 脉冲 | 加载、更新提示 |
| bounce | 0.4s | 反弹 | 导航激活 |
| scaleIn | 0.4s | 放大进入 | 按钮、浮动按钮 |
| rotateIn | 0.3s | 旋转进入 | 开关切换 |

### 交互反馈

**点击反馈**:
- 按钮: 0.95倍缩放 + 阴影
- 列表项: 0.95倍缩放 + 背景变色
- 工具: 0.85倍缩放 + 颜色变化

**悬停效果** (桌面设备):
- 按钮: 向上偏移2px + 阴影增大
- 列表项: 向上偏移2px + 阴影出现

**输入框聚焦**:
- 边框变色: 主色
- 阴影: 彩色阴影
- 缩放: 1.02倍

### Toast提示样式

| 类型 | 背景色 | 图标 | 用途 |
|------|--------|------|------|
| success | #27ae60 (绿) | ✓ | 操作成功 |
| error | #dc3545 (红) | ❌ | 操作失败 |
| warning | #f39c12 (橙) | ⚠️ | 警告提示 |
| info | rgba(0,0,0,0.7) | ℹ️ | 信息通知 |

---

## 故障排除

### 常见问题与解决方案

#### Q1: 书源导入失败

**症状**: 点击导入后显示"❌ 导入失败"

**原因分析**:
1. 数据格式错误 (JSON/XML语法)
2. 网络连接问题
3. CORS跨域限制
4. 数据为空

**解决方案**:
1. 检查数据格式是否符合规范
2. 确保网络连接正常
3. 尝试通过URL直接导入
4. 确保URL返回有效数据

#### Q2: 书籍列表为空

**症状**: 点击书源显示"未找到书籍"

**原因分析**:
1. 书源返回数据格式问题
2. 书籍数据字段名不匹配
3. URL返回错误响应

**解决方案**:
1. 检查数据格式是否包含`books`、`list`或顶级数组
2. 确保字段名为: `title`、`author`、`cover`、`chapters`
3. 检查URL是否可访问 (浏览器直接访问URL)

#### Q3: 阅读进度未保存

**症状**: 关闭应用后进度丢失

**原因分析**:
1. localStorage被清除
2. 应用强制停止
3. 设备内存不足

**解决方案**:
1. 检查设备存储空间
2. 不要强制停止应用，正常退出
3. 避免频繁清除缓存

#### Q4: 手势翻页不响应

**症状**: 滑动屏幕不翻页

**原因分析**:
1. 滑动距离<50px
2. 滑动时间>500ms（被视为拖动）
3. 在非阅读页面滑动

**解决方案**:
1. 确保滑动距离足够(>50px)
2. 快速滑动(保持<500ms)
3. 确保在"📖 阅读中"页面
4. 使用键盘快捷键替代

#### Q5: 应用崩溃

**症状**: 应用突然关闭

**原因分析**:
1. 内存不足
2. 导入超大数据集
3. 网络超时

**解决方案**:
1. 清除缓存释放空间
2. 分次导入较小数据集
3. 检查网络连接
4. 重启应用

---

## 技术架构

### 技术栈

```
Frontend Framework: Cordova (Apache Cordova)
Platform: Android 6.0+ (API 23+)
Languages: HTML5, CSS3, JavaScript (ES6+)
Storage: LocalStorage (浏览器存储)
Networking: Fetch API
```

### 应用架构

```
┌─── www/
│   ├── index.html (主应用, 1339行)
│   │   ├── HTML结构
│   │   ├── CSS全局样式
│   │   └── JavaScript交互逻辑
│   └── (其他静态资源)
│
├── config.xml (Cordova配置)
├── package.json (项目依赖)
└── (构建脚本和文档)
```

### 模块划分

```javascript
1. 全局变量与初始化
   - localStorage数据加载
   - 页面初始化
   - 手势处理
   - 快捷键绑定

2. 页面切换系统
   - switchPage()
   - 页面过渡动画
   - 导航栏更新

3. 书源管理模块
   - renderSources()
   - openModal() / closeModal()
   - saveSource() / editSource() / deleteSource()

4. 导入系统
   - openImportModal() / closeImportModal()
   - executeImport()
   - parseJSON() / parseXML() / parseText()
   - loadFromURL()

5. 书籍加载与显示
   - loadBooksFromSource()
   - displayBooks()
   - openBook()

6. 阅读器模块
   - loadChapter()
   - prevChapter() / nextChapter()
   - renderCatalog()
   - addToShelf()

7. 书架管理
   - renderShelf()
   - openBookFromShelf()

8. 设置与辅助
   - toggleDarkMode()
   - clearCache()
   - showToast()
   - saveReadingProgress() / loadProgressTracking()
```

### 数据流

```
用户输入
   ↓
事件监听 (onClick, onTouchEnd, onKeyDown等)
   ↓
业务逻辑处理
   ↓
数据更新 (localStorage)
   ↓
DOM更新
   ↓
动画渲染
   ↓
用户反馈 (Toast通知)
```

### 性能优化

1. **缓存机制**: 书籍数据缓存在内存中，避免重复加载
2. **懒加载**: 当前可见内容优先加载
3. **事件委托**: 列表项使用事件委托减少监听器数量
4. **防抖/节流**: 搜索、滚动事件优化
5. **Passive事件**: 触摸事件使用passive监听提升滚动性能

---

## 附录：功能检查清单

### 基础功能
- [x] 应用启动和初始化
- [x] 书源列表显示
- [x] 新增书源
- [x] 编辑书源
- [x] 删除书源
- [x] 导入JSON书源
- [x] 导入XML书源
- [x] 导入文本列表
- [x] 从URL导入

### 阅读功能
- [x] 选择书源
- [x] 加载书籍列表
- [x] 打开书籍
- [x] 显示章节
- [x] 上一章/下一章
- [x] 章节目录
- [x] 快速跳转
- [x] 进度显示

### 书架功能
- [x] 添加到书架
- [x] 书架列表显示
- [x] 按时间排序
- [x] 进度条显示
- [x] 从书架打开

### 设置与辅助
- [x] 深色/浅色主题
- [x] 主题状态保存
- [x] 清除缓存
- [x] 进度自动保存
- [x] 进度自动恢复

### 交互与动画
- [x] 页面切换动画
- [x] 列表项动画
- [x] 按钮反馈
- [x] 手势识别 (滑动翻页)
- [x] 键盘快捷键
- [x] Toast通知
- [x] Loading动画
- [x] 过渡动画

---

**文档维护**: 每次功能更新时同步更新该文档

**最后更新**: 2026年2月14日

